{% extends "admin/base_site.html" %}
{% load static custom_tags %}

{% block content %}
<h1>Lista de Detalles de Compra</h1>

<form method="get" style="margin-bottom: 20px;">
    <label for="proveedor">Proveedor:</label>
    <select name="proveedor" id="proveedor">
        <option value="">Todos</option>
        {% for proveedor in proveedores %}
            <option value="{{ proveedor.id }}" {% if proveedor.id|stringformat:"s" == proveedor_id %}selected{% endif %}>{{ proveedor.nombre }}</option>
        {% endfor %}
    </select>

    <label for="producto">Producto:</label>
    <select name="producto" id="producto">
        <option value="">Todos</option>
        {% for producto in productos %}
            <option value="{{ producto.id }}" {% if producto.id|stringformat:"s" == producto_id %}selected{% endif %}>{{ producto.nombre }}</option>
        {% endfor %}
    </select>

    <label for="fecha_inicio">Fecha Inicio:</label>
    <input type="date" id="fecha_inicio" name="fecha_inicio" value="{{ fecha_inicio }}">

    <label for="fecha_fin">Fecha Fin:</label>
    <input type="date" id="fecha_fin" name="fecha_fin" value="{{ fecha_fin }}">

    <button type="submit">Filtrar</button>
</form>

<p><strong>Total en el rango de fechas:</strong> {{ total_en_rango }}</p>

<table border="1" cellpadding="5" cellspacing="0" style="width: 100%;">
    <thead>
        <tr>
            <th>ID</th>
            <th>Fecha de Compra</th>
            <th>Proveedor</th>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Valor del Producto</th>
            <th>Total</th>
            <th>Descripción</th>
            <th>Método de Pago</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for detalle in detalles_compras %}
            <tr>
                <td>{{ detalle.id }}</td>
                <td>{{ detalle.compra.fecha_compra }}</td>
                <td>{{ detalle.compra.proveedor.nombre }}</td>
                <td>{{ detalle.producto.nombre }}</td>
                <td>{{ detalle.cantidad }}</td>
                <td>{{ detalle.precio_unitario }}</td>
                <td>{{ detalle.cantidad|multiply:detalle.precio_unitario }}</td>
                <td>{{ detalle.descripcion }}</td>
                <td>{{ detalle.compra.get_metodo_pago_display }}</td>
                <td><a href="{% url 'admin:ventas_compra_change' detalle.compra.id %}">Ver en Admin</a></td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="10">No hay detalles de compra que coincidan con los filtros.</td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
