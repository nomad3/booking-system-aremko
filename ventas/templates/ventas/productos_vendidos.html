{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h1>Productos Vendidos</h1>

    <!-- Formulario de búsqueda y filtros -->
    <form method="GET" action="" class="form-inline mb-4">
        <div class="form-group mx-sm-3 mb-2">
            <label for="fecha_inicio" class="sr-only">Fecha Inicio</label>
            <input type="date" id="fecha_inicio" name="fecha_inicio" value="{{ fecha_inicio|date:'Y-m-d' }}" class="form-control" placeholder="Fecha Inicio" required>
        </div>
        <div class="form-group mx-sm-3 mb-2">
            <label for="fecha_fin" class="sr-only">Fecha Fin</label>
            <input type="date" id="fecha_fin" name="fecha_fin" value="{{ fecha_fin|date:'Y-m-d' }}" class="form-control" placeholder="Fecha Fin" required>
        </div>
        <div class="form-group mx-sm-3 mb-2">
            <label for="categoria" class="sr-only">Categoría</label>
            <select id="categoria" name="categoria" class="form-control">
                <option value="">Todas las categorías</option>
                {% for categoria in categorias %}
                    <option value="{{ categoria.id }}" {% if categoria_id == categoria.id %}selected{% endif %}>{{ categoria.nombre }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group mx-sm-3 mb-2">
            <label for="venta_reserva_id" class="sr-only">ID Venta/Reserva</label>
            <input type="text" id="venta_reserva_id" name="venta_reserva_id" value="{{ venta_reserva_id }}" class="form-control" placeholder="ID Venta/Reserva">
        </div>
        <button type="submit" class="btn btn-primary mb-2">Buscar</button>
    </form>

    <!-- Tabla de productos vendidos -->
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ID Venta/Reserva</th>
                <th>Cliente</th>
                <th>Categoría del Producto</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Monto Total</th>
            </tr>
        </thead>
        <tbody>
            {% for producto in productos %}
            <tr>
                <td>
                    <a href="{% url 'admin:ventas_ventareserva_change' producto.venta_reserva_id %}">
                        {{ producto.venta_reserva_id }}
                    </a>
                </td>
                <td>{{ producto.venta_reserva__cliente__nombre }}</td>
                <td>{{ producto.producto__categoria__nombre }}</td>
                <td>{{ producto.producto__nombre }}</td>
                <td>{{ producto.cantidad }}</td>
                <td>${{ producto.precio_unitario|floatformat:0 }}</td>
                <td>${{ producto.total_monto|floatformat:0 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7">No se encontraron productos vendidos.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %} 